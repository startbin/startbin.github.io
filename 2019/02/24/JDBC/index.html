<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>JDBC | Quantity Accumulation and Quality Leap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="JDBC概述 1.1.1什么是JDBCJDBC（JavaDataBase Connectivity,java数据库连接）是一种用于执行SQL语句的JavaAPI。JDBC是Java访问数据库的标准规范，可以为不同的关系型数据库提供统一访问，它由一组用Java语言编写的接口(大部分)和类组成。 1.1.2什么是数据库驱动JDBC需要连接驱动，驱动是两个设备要进行通信，满足一定通信数据格式，数据格式由">
<meta property="og:type" content="article">
<meta property="og:title" content="JDBC">
<meta property="og:url" content="http://yoursite.com/2019/02/24/JDBC/index.html">
<meta property="og:site_name" content="Quantity Accumulation and Quality Leap">
<meta property="og:description" content="JDBC概述 1.1.1什么是JDBCJDBC（JavaDataBase Connectivity,java数据库连接）是一种用于执行SQL语句的JavaAPI。JDBC是Java访问数据库的标准规范，可以为不同的关系型数据库提供统一访问，它由一组用Java语言编写的接口(大部分)和类组成。 1.1.2什么是数据库驱动JDBC需要连接驱动，驱动是两个设备要进行通信，满足一定通信数据格式，数据格式由">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://i.imgur.com/rtHrMgC.png">
<meta property="og:image" content="https://i.imgur.com/jB8ISfz.png">
<meta property="og:image" content="https://i.imgur.com/L2Pv58f.png">
<meta property="og:updated_time" content="2019-02-24T15:03:52.079Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JDBC">
<meta name="twitter:description" content="JDBC概述 1.1.1什么是JDBCJDBC（JavaDataBase Connectivity,java数据库连接）是一种用于执行SQL语句的JavaAPI。JDBC是Java访问数据库的标准规范，可以为不同的关系型数据库提供统一访问，它由一组用Java语言编写的接口(大部分)和类组成。 1.1.2什么是数据库驱动JDBC需要连接驱动，驱动是两个设备要进行通信，满足一定通信数据格式，数据格式由">
<meta name="twitter:image" content="https://i.imgur.com/rtHrMgC.png">
  
    <link rel="alternate" href="/atom.xml" title="Quantity Accumulation and Quality Leap" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Quantity Accumulation and Quality Leap</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-JDBC" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/24/JDBC/" class="article-date">
  <time datetime="2019-02-24T14:38:40.000Z" itemprop="datePublished">2019-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JDBC
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>JDBC概述</p>
<p>1.1.1什么是JDBC<br>JDBC（Java<br>DataBase Connectivity,java数据库连接）是一种用于执行SQL语句的Java<br>API。JDBC是Java访问数据库的标准规范，可以为不同的关系型数据库提供统一访问，它由一组用Java语言编写的接口(大部分)和类组成。</p>
<p>1.1.2什么是数据库驱动<br>JDBC需要连接驱动，驱动是两个设备要进行通信，满足一定通信数据格式，数据格式由设备提供商规定，设备提供商为设备提供驱动软件，通过软件可以与该设备进行通信。<br>今天我们使用的是mysql的驱动mysql-connector-java-5.1.37-bin.jar</p>
<p>JDBC与数据库驱动的关系:接口与实现的关系。<br><img src="https://i.imgur.com/rtHrMgC.png" alt=""></p>
<p>JDBC规范（掌握四个核心对象）：<br>DriverManager:用于注册驱动<br>Connection: 表示与数据库创建的连接<br>Statement: 操作数据库sql语句的对象<br>ResultSet: 结果集或一张虚拟表</p>
<p>1.2JDBC原理<br>Java提供访问数据库规范称为JDBC，而生产厂商提供规范的实现类称为驱动</p>
<p><img src="https://i.imgur.com/jB8ISfz.png" alt=""></p>
<p>JDBC是接口，驱动是接口的实现，没有驱动将无法完成数据库连接，从而不能操作数据库！每个数据库厂商都需要提供自己的驱动，用来连接自己公司的数据库，也就是说驱动一般都由数据库生成厂商提供。</p>
<p>1.3JDBC入门案例<br>1.3.1准备数据<br>之前我们学习了sql语句的使用，并创建的分类表category，今天我们将使用JDBC对分类表进行增删改查操作。<br>创建数据库</p>
<p>create database day04;<br>使用数据库</p>
<p>use day04;<br>创建分类表</p>
<p>create table category(<br>cid int PRIMARY KEY AUTO_INCREMENT,<br>cname varchar(100)<br>);<br>初始化数据</p>
<p>insert into category (cname) values(‘家电’);<br>insert into category (cname) values(‘服饰’);<br>insert into category (cname) values(‘化妆品’);<br>1.3.2导入驱动jar包<br>创建lib目录，用于存放当前项目需要的所有jar包<br>选择jar包，右键执行build path / Add to Build Path<br><img src="https://i.imgur.com/L2Pv58f.png" alt=""></p>
<p>1.3.3开发步骤</p>
<pre><code>注册驱动.

获得连接.

获得执行sql语句的对象

执行sql语句，并返回结果

处理结果

释放资源.
</code></pre><p>1.3.4案例实现</p>
<p>@Test<br>//// 查询所有的分类信息<br>public void demo1() throws Exception{<br>    // 注意：使用JDBC规范，采用都是 java.sql包下的内容<br>    //1 注册驱动<br>    Class.forName(“com.mysql.jdbc.Driver”);<br>    //2 获得连接<br>    String url = “jdbc:mysql://localhost:3306/mydb”;<br>    Connection conn = DriverManager.getConnection(url, “root”, “root”);<br>    //3获得执行sql语句的对象<br>    Statement stmt = conn.createStatement();<br>    //4执行SQL语句<br>    ResultSet rs = stmt.executeQuery(“select  from category”);</p>
<pre><code>//5处理结果集
while(rs.next()){
    // 获得一行数据
    Integer cid = rs.getInt(&quot;cid&quot;);
    String cname = rs.getString(&quot;cname&quot;);
    System.out.println(cid + &quot; , &quot; + cname);
}
//6释放资源
rs.close();
stmt.close();
conn.close();
</code></pre><p>}</p>
<p>1.4API详解</p>
<p>1.4.1API详解：注册驱动</p>
<p>DriverManager.registerDriver(new com.mysql.jdbc.Driver());不建议使用<br>原因有2个：</p>
<pre><code>导致驱动被注册2次。
强烈依赖数据库的驱动jar
解决办法：
Class.forName(&quot;com.mysql.jdbc.Driver&quot;);
</code></pre><p>1.4.2API详解：获得链接</p>
<p>static Connection getConnection(String url, String user, String password)<br>试图建立到给定数据库 URL 的连接。<br>参数说明：url 需要连接数据库的位置（网址） user用户名password 密码<br>例如：getConnection(“jdbc:mysql://localhost:3306/day06”, “root”, “root”);</p>
<p>URL:SUN公司与数据库厂商之间的一种协议。<br>jdbc:mysql://localhost:3306/day06<br>协议 子协议IP : 端口号数据库<br>mysql: jdbc:mysql://localhost:3306/day04或者jdbc:mysql:///day14（默认本机连接）</p>
<p>oracle数据库: jdbc:oracle:thin:@localhost:1521:sid</p>
<p>1.4.3java.sql.Connection接口：一个连接</p>
<p>接口的实现在数据库驱动中。所有与数据库交互都是基于连接对象的。</p>
<p>StatementcreateStatement(); //创建操作sql语句的对象</p>
<p>1.4.4API详解：java.sql.Statement接口: 操作sql语句，并返回相应结果</p>
<p>String sql = “某SQL语句”;<br>获取Statement语句执行平台：Statement stmt = con.createStatement();<br>常用方法：<br>int executeUpdate(String sql); –执行insert update delete语句.<br>ResultSet executeQuery(String sql); –执行select语句.<br>boolean execute(String sql); –仅当执行select并且有结果时才返回true，执行其他的语句返回false.</p>
<p>1.4.5API详解：处理结果集（注：执行insert、update、delete无需处理）</p>
<p>ResultSet实际上就是一张二维的表格，我们可以调用其boolean</p>
<p>next()方法指向某行记录，当第一次调用next()方法时，便指向第一行记录的位置，这时就可以使用ResultSet提供的getXXX(int<br>col)方法(与索引从0开始不同个，列从1开始)来获取指定列的数据：<br>rs.next();//指向第一行<br>rs.getInt(1);//获取第一行第一列的数据<br>常用方法：<br>Object getObject(int index) / Object getObject(String name) 获得任意对象<br>String getString(int index)/ String getString(String name) 获得字符串<br>int getInt(int index)/int getInt(String name) 获得整形<br>double getDouble(int index)/ double getDouble(String name) 获得双精度浮点型</p>
<p>1.4.6API详解：释放资源</p>
<p>与IO流一样，使用后的东西都需要关闭！关闭的顺序是先得到的后关闭，后得到的先关闭。<br>rs.close();<br>stmt.close();<br>con.close();</p>
<p>1.5JDBC工具类</p>
<p>“获得数据库连接”操作，将在以后的增删改查所有功能中都存在，可以封装工具类JDBCUtils。提供获取连接对象的方法，从而达到代码的重复利用。<br>该工具类提供方法：public static Connection getConn ()。代码如下：</p>
<p>public class JdbcUtils {</p>
<pre><code>private static String driver = &quot;com.mysql.jdbc.Driver&quot;;
private static String url = &quot;jdbc:mysql://localhost:3306/webdb_4&quot;;
private static String user = &quot;root&quot;;
private static String password = &quot;root&quot;;

static{
    try {
        //注册驱动
        Class.forName(driver);
    } catch (Exception e) {
        throw new RuntimeException(e);
    }

}

/**
</code></pre><p> 获得连接<br>      @return<br>      @throws SQLException<br>     /<br>    public static Connection getConnection() throws  SQLException{<br>        //获得连接<br>        Connection conn = DriverManager.getConnection(url, user, password);<br>        return conn;<br>    }</p>
<pre><code>/**
  释放资源
  @param conn
  @param st
  @param rs
 /
public static void closeResource(Connection conn , Statement st , ResultSet rs){

    if(rs != null){
        try {
            rs.close();
        } catch (SQLException e) {
        }
    }

    if(st != null){
        try {
            st.close();
        } catch (SQLException e) {
        }
    }

    if(conn != null){
        try {
            conn.close();
        } catch (SQLException e) {
        }
    }

}
</code></pre><p>1.6JDBC增删改查操作</p>
<p>1.6.1插入</p>
<p>@Test<br>public void demo01(){<br>    //添加</p>
<pre><code>Connection conn = null;
Statement st = null;
ResultSet rs = null;

try {
    //1 获得连接
    conn = JdbcUtils.getConnection();

    //操作
    //1) 获得语句执行者
    st = conn.createStatement();
    //2) 执行sql语句
    int r = st.executeUpdate(&quot;insert into category(cname) values(&apos;测试&apos;)&quot;);

    //3) 处理结果
    System.out.println(r);

} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    //释放资源
    JdbcUtils.closeResource(conn, st, rs);
}
</code></pre><p>}</p>
<p>1.6.2修改</p>
<p>@Test<br>public void demo02(){<br>    //修改<br>    Connection conn = null;<br>    Statement st = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    st = conn.createStatement();
    int r = st.executeUpdate(&quot;update category set cname=&apos;测试2&apos; where cid = 4&quot;);
    System.out.println(r);

} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, st, rs);
}
</code></pre><p>}</p>
<p>1.6.3删除</p>
<p>@Test<br>public void demo03(){<br>    //删除<br>    Connection conn = null;<br>    Statement st = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    //操作
    st = conn.createStatement();
    int r = st.executeUpdate(&quot;delete from category where cid = 4&quot;);
    System.out.println(r);

} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, st, rs);
}
</code></pre><p>}</p>
<p>1.6.4通过id查询详情</p>
<p>@Test<br>public void demo04(){<br>    //通过id查询详情<br>    Connection conn = null;<br>    Statement st = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    //操作
    st = conn.createStatement();
    rs = st.executeQuery(&quot;select  from category where cid = 30&quot;);

    if(rs.next()){
        String cid = rs.getString(&quot;cid&quot;);
        String cname = rs.getString(&quot;cname&quot;);
        System.out.println(cid + &quot; @ &quot; + cname );
    } else {
        System.out.println(&quot;没有数据&quot;);
    }

} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, st, rs);
}
</code></pre><p>}</p>
<p>1.6.5查询所有</p>
<p>@Test<br>public void demo05(){<br>    //查询所有<br>    Connection conn = null;<br>    Statement st = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    //操作
    st = conn.createStatement();
    rs = st.executeQuery(&quot;select 
</code></pre><p> from category”);</p>
<pre><code>    while(rs.next()){
        String cid = rs.getString(&quot;cid&quot;);
        String cname = rs.getString(&quot;cname&quot;);
        System.out.println(cid + &quot; @ &quot; + cname );
    }

} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, st, rs);
}
</code></pre><p>}</p>
<p>1.7预处理对象</p>
<p>1.7.1SQL注入问题</p>
<p>SQL注入：用户输入的内容作为了SQL语句语法的一部分，改变了原有SQL真正的意义。<br>假设有登录案例SQL语句如下:<br>SELECT FROM 用户表 WHERE NAME = 用户输入的用户名 AND PASSWORD = 用户输的密码;<br>此时，当用户输入正确的账号与密码后，查询到了信息则让用户登录。但是当用户输入的账号为XXX 密码为：XXX’OR ‘a’=’a时，则真正执行的代码变为：<br>SELECT FROM 用户表 WHERE NAME = ‘XXX’ AND PASSWORD =’ XXX’OR ’a’=’a’;<br>此时，上述查询语句时永远可以查询出结果的。那么用户就直接登录成功了，显然我们不希望看到这样的结果，这便是SQL注入问题。<br>为此，我们使用PreparedStatement来解决对应的问题。</p>
<p>1.7.2API详解：预处理对象<br>preparedStatement：预编译对象，是Statement对象的子类。<br>特点：<br>性能高<br>会把sql语句先编译<br>能过滤掉用户输入的关键字。</p>
<p>PreparedStatement预处理对象，处理的每条sql语句中所有的实际参数，都必须使用占位符?替换。<br>String sql = “select from user where username = ? and password = ?”;<br>PreparedStatement使用，需要通过以下3步骤完成：</p>
<pre><code>PreparedStatement预处理对象代码：
</code></pre><p>#获得预处理对象，需要提供已经使用占位符处理后的SQL语句</p>
<p>PreparedStatement psmt = conn.prepareStatement(sql)</p>
<pre><code>设置实际参数
void setXxx(int index, Xxx xx) 将指定参数设置指定类型的值
参数1：index 实际参数序列号，从1开始。
参数2：xxx 实际参数值，xxx表示具体的类型。
例如：
setString(2, &quot;1234&quot;) 把SQL语句中第2个位置的占位符?替换成实际参数 &quot;1234&quot;

执行SQL语句:
int executeUpdate(); --执行insert update delete语句.
ResultSet executeQuery(); --执行select语句.
boolean execute(); --执行select返回true 执行其他的语句返回false.
</code></pre><p>1.7.3插入</p>
<p>@Test<br>public void demo01(){<br>    //添加：向分类表中添加数据<br>    Connection conn = null;<br>    PreparedStatement psmt = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    //1 获得连接
    conn = JdbcUtils.getConnection();
    //2 处理sql语句
    String sql = &quot;insert into category(cname) values(? )&quot;;
    //3获得预处理对象
    psmt = conn.prepareStatement(sql);
    //4设置实际参数
    psmt.setString(1,&quot;预处理&quot;);
    //5执行
    int r = psmt.executeUpdate();

    System.out.println(r);

} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    //6释放资源
    JdbcUtils.closeResource(conn, psmt, rs);
}
}
</code></pre><p>1.7.4更新</p>
<p>@Test<br>public void demo02(){<br>    //修改<br>    Connection conn = null;<br>    PreparedStatement psmt = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    //1 sql语句
    String sql = &quot;update category set cname = ? where cid = ?&quot;;
    //2 获得预处理对象
    psmt = conn.prepareStatement(sql);
    //3设置实际参数
    psmt.setString(1, &quot;测试数据&quot;);
    psmt.setInt(2, 4);
    //4执行
    int r = psmt.executeUpdate();
    System.out.println(r);


} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, psmt, rs);
}


}
</code></pre><p>1.7.5删除</p>
<p>@Test<br>public void demo03(){<br>    //删除<br>    Connection conn = null;<br>    PreparedStatement psmt = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    //1 sql语句
    String sql = &quot;delete from category where cid = ?&quot;;
    //2 获得预处理对象
    psmt = conn.prepareStatement(sql);
    //3设置实际参数
    psmt.setInt(1, 4);
    //4执行
    int r = psmt.executeUpdate();
    System.out.println(r);


} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, psmt, rs);
}
}
</code></pre><p>1.7.6查询所有</p>
<p>@Test<br>public void demo04(){<br>    //查询所有<br>    Connection conn = null;<br>    PreparedStatement psmt = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    String sql = &quot;select 
</code></pre><p> from category”;<br>        psmt = conn.prepareStatement(sql);<br>        rs = psmt.executeQuery();<br>        while(rs.next()){<br>            String cname = rs.getString(“cname”);<br>            System.out.println(cname);<br>        }<br>    } catch (Exception e) {<br>        throw new RuntimeException(e);<br>    } finally{<br>        JdbcUtils.closeResource(conn, psmt, rs);<br>    }<br>    }</p>
<p>1.7.7通过id查询详情</p>
<p>@Test<br>public void demo05(){<br>    //通过id查询<br>    Connection conn = null;<br>    PreparedStatement psmt = null;<br>    ResultSet rs = null;</p>
<pre><code>try {
    conn = JdbcUtils.getConnection();

    String sql = &quot;select * from category where cid = ?&quot;;
    psmt = conn.prepareStatement(sql);
    psmt.setInt(1, 2);
    rs = psmt.executeQuery();
    if(rs.next()){
        System.out.println(&quot;查询到&quot;);
    } else {
        System.out.println(&quot;查询不到&quot;);
    }


} catch (Exception e) {
    throw new RuntimeException(e);
} finally{
    JdbcUtils.closeResource(conn, psmt, rs);
}
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/24/JDBC/" data-id="cjsj1n8e80004koot87y8tbi2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/02/12/MySQL基础/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">MySQL基础</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/24/JDBC/">JDBC</a>
          </li>
        
          <li>
            <a href="/2019/02/12/MySQL基础/">MySQL基础</a>
          </li>
        
          <li>
            <a href="/2019/02/03/JavaNIO/">JavaNIO</a>
          </li>
        
          <li>
            <a href="/2019/01/30/认识docker/">认识docker</a>
          </li>
        
          <li>
            <a href="/2019/01/26/Java面试/">Java面试</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Zhang Bin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>